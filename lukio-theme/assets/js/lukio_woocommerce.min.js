jQuery(document).ready(function(e){function t(e){return e.replaceAll(" ",".")}function o(e){lukio_helpers.animate_size(e,"height",0,400,0,{opacity:"0"},()=>{e.remove()})}function i(e){return 0!=e.siblings().length}function l(e){h&&p&&(localStorage.setItem(m,e),sessionStorage.setItem(m,e))}function r(t,o){t.each(function(){let t=this.outerHTML,i=e(this),l=i.data("place");e(this).remove(),"viewport"==l?o.append(t):o.closest(".woocommerce-product-gallery").append(t)})}async function a(e,t){let o=e[0].outerHTML;e.remove(),t.append(o)}function n(e,t,o){if(e.data("loop"))return;let i=e.closest(".woocommerce-product-gallery"),l=i.find(".lukio_product_gallery_arrow"),r=t.children("li"),a=0==o?"addClass":"removeClass",n=o==r.length-1?"addClass":"removeClass";l.filter(".prev")[a]("disable"),l.filter(".next")[n]("disable")}function c(t,o){let i=t.find(".lukio_product_gallery_arrow.prev"),l=t.find("ol.flex-control-nav"),r=o+1;l.find(`.${w}`).removeClass(w),l.find(`li:nth-of-type(${r})`).addClass(w),n(i,l,o);let a=l.find(`.${w}`);lukio_helpers.scroll_horizontally(a,l),t.find(".lukio_product_gallery_pagination_dot.active").removeClass("active"),t.find(`.lukio_product_gallery_pagination_dot:nth-of-type(${r})`).addClass("active"),e(".lukio_wc_gallery_video").each(function(){this.muted=!0}),u.trigger("lukio_gallery_display_updated",[t,l,a,o])}async function s(){clearTimeout(v);let t=e(".lukio_product_gallery_arrow"),o=e(".lukio_product_gallery_pagination"),i=t.closest(".flex-viewport"),l=t.closest(".woocommerce-product-gallery"),n=l.find("ol.flex-control-nav.flex-control-thumbs"),s=e(".lukio_wc_gallery_video_wrapper");0!==t.length&&(n.addClass("lukio_product_gallery_thumbs"),n.lukioDragScroll(),r(t,i),0!=o.length&&await a(o,i),c(l,0)),0!=s.length&&s.each(function(){e(`.woocommerce-product-gallery .flex-control-nav.flex-control-thumbs li:nth-of-type(${e(this).index()+1})`).addClass("lukio_wc_gallery_video_thumb")})}let _=e(".lukio_mini_cart_wrapper"),u=e("body"),d=window.location.origin+window.location.pathname,m=wc_cart_fragments_params.cart_hash_key,f="wc_fragments_refreshed",g=d==lukio_woo.checkout_url,p=d==lukio_woo.cart_url||g,h=!0,k=!1,w="lukio_active_thumb",v=null;switch(v=setTimeout(()=>{s()},5e3),d){case lukio_woo.checkout_url:f+=" updated_checkout";break;case lukio_woo.cart_url:f="updated_cart_totals wc_cart_emptied";break;default:f+=" wc_fragments_loaded"}try{window.sessionStorage.setItem("lukio_storage_check","test"),window.sessionStorage.removeItem("lukio_storage_check"),window.localStorage.setItem("lukio_storage_check","test"),window.localStorage.removeItem("lukio_storage_check")}catch(e){h=!1}h&&p&&e(window).on("storage onstorage",function(e){m===e.originalEvent.key&&localStorage.getItem(m)!==sessionStorage.getItem(m)&&(g&&(k=!0),u.trigger("lukio_update_wc_parts"))}),u.on(f,function(){k?k=!1:e.ajax({method:"POST",url:lukio_localize.ajax_url,data:{action:"lukio_woocommerce_refresh_mini_cart"},success:function(o){if(o){if(o=JSON.parse(o),!1===u.triggerHandler("lukio_should_fully_refresh_minicart")){let i=document.createElement("div");i.innerHTML=o.fragment;let l=e(i);i.remove(),l.find(".always_refresh").each(function(){_.find("."+t(this.className)).html(this.innerHTML)}),u.trigger("lukio_minicart_not_fully_refreshed",[l])}else _.html(o.fragment);l(o.cart_hash),u.trigger("lukio_cart_num_refresh",[o.items_count]).trigger("lukio_refresh_mini_cart_extra",[o.extra]).trigger("lukio_minicart_refreshed")}}})}).on("should_send_ajax_request.adding_to_cart",function(t,o){if(o.hasClass("disabled"))return!1;let i=o.closest(".lukio_theme_add_to_cart_form_wrapper");if(1==i.length){let t=i.find('input[name="quantity"]');1==t.length&&o.attr("data-quantity",t.val());let l=i.find('input[name="variation_id"]');1==l.length&&o.attr("data-product_id",l.val());let r={};1==i.length&&i.find("select[name^=attribute").each(function(){r[e(this).attr("name")]=this.value}),o.data("lukio_attributes",JSON.stringify(r))}}).on("lukio_update_wc_parts",function(){switch(window.location.origin+window.location.pathname){case lukio_woo.checkout_url:u.trigger("update_checkout");break;case lukio_woo.cart_url:u.trigger("wc_update_cart");break;default:u.trigger("wc_fragment_refresh")}}),e(document).on("click",".lukio_cart_product_quantity_btn",function(){let t=e(this),o=t.parent(),i=o.find(".lukio_cart_product_quantity_input");if(o.hasClass("working")||t.hasClass("plus")&&o.hasClass("plus_disabled"))return;let l=parseInt(i.val());t.hasClass("minus")?l--:t.hasClass("plus")&&l++,i.val(l).trigger("change")}).on("input",".lukio_cart_product_quantity_input",function(){let t=e(this),o=t.val(),i=parseInt(t.attr("max"));o=o.replaceAll(/[^0-9]/g,""),o=""!=o?parseInt(o):"",t.val(""!=o&&-1!=i&&o>i?i:o)}).on("keypress",".lukio_cart_product_quantity_input",function(t){"Enter"===t.key&&(t.preventDefault(),e(this).trigger("change"))}).on("change",".lukio_cart_product_quantity_input",function(){let l=e(this),r=l.parent(),a=l.closest("li"),n=l.val();n=""===n?0:n,r.addClass("working"),e.ajax({method:"POST",url:lukio_localize.ajax_url,data:{action:"lukio_update_cart_quantity",cart_item:r.data("key"),quantity:n},success:function(){if(1==a.closest(".lukio_mini_cart_wrapper").length){let e=i(a);(e||!e&&0!=n)&&u.one("lukio_should_fully_refresh_minicart",function(){return!1}).one("lukio_minicart_not_fully_refreshed",function(e,i){0!=n?a.html(i.find("."+t(a.attr("class"))).eq(a.index()).html()):o(a)})}u.trigger("lukio_update_wc_parts")}})}).on("click",".lukio_mini_cart_wrapper .remove",function(){let t=e(this).closest("li");i(t)?u.one("wc_fragments_loaded",function(){u.one("lukio_should_fully_refresh_minicart",function(){return!1}),p&&u.trigger("lukio_update_wc_parts")}).one("lukio_minicart_refreshed",function(){o(t)}):u.one("wc_fragments_loaded",function(){p&&u.trigger("lukio_update_wc_parts")})}).on("click",".woocommerce-product-gallery ol.flex-control-nav.flex-control-thumbs li",function(t){let o=e(this);if("LI"==t.target.tagName)o.find("img").trigger("click");else{let e=o.closest(".flex-control-nav.flex-control-thumbs"),t=e.closest(".woocommerce-product-gallery"),i=o.index();c(t,i)}}).on("click",".lukio_product_gallery_arrow",function(t){t.stopPropagation();let o=e(this);if(o.hasClass("disbled"))return;let i=o.data("action"),l=o.closest(".woocommerce-product-gallery"),r=o.data("loop"),a="next"==i?1:-1,n=l.find("ol.flex-control-nav"),c=n.find("li"),s=c.length-1,_=n.find(".flex-active").closest("li"),u=_.index()+a;u<0?u=r?s:0:u>s&&(u=r?0:s);let d=c.eq(u);d.find("img").trigger("click")}).on("click",".lukio_product_gallery_pagination_dot",function(){let t=e(this),o=t.data("index"),i=t.closest(".woocommerce-product-gallery");t.hasClass("active")||i.find("ol.flex-control-nav li").eq(o).find("img").trigger("click")}).on("zoom.destroy",".woocommerce-product-gallery__image.flex-active-slide",function(){let t=e(this).closest(".woocommerce-product-gallery"),o=t.find(".flex-control-nav.flex-control-thumbs .flex-active").closest("li").index();c(t,o)}).on("click",".lukio_woocommerce_product_variations_li",function(t){t.stopPropagation();let o=e(this);if(o.hasClass("selected"))return;let i=o.data("value"),l=o.closest(".lukio_woocommerce_product_variations_wrapper"),r=l.find(".lukio_woocommerce_product_variations_dropdown_display");l.find(".lukio_woocommerce_product_variations_li.selected").removeClass("selected"),o.addClass("selected"),l.find("select").val(i).trigger("change"),0!=r.length&&(r.text(o.text()),e("body").trigger("click.lukio_woocommerce_product_variation_clicked"))}).on("keydown",".lukio_woocommerce_product_variations_li",function(t){!t.key||"enter"!=t.key.toLocaleLowerCase()&&" "!=t.key||(t.preventDefault(),e(this).trigger("click"))}).on("click",".variations_form a.reset_variations",function(){let t=e(this).closest("form");t.find(".lukio_woocommerce_product_variations_li.selected").removeClass("selected"),t.find(".lukio_woocommerce_product_variations_dropdown_display").each(function(){let t=e(this);t.text(t.data("placeholder"))})}).on("click",".lukio_woocommerce_product_variations_dropdown",function(){let t=e(this),o=t.find(".lukio_woocommerce_product_variations_ul");t.addClass("open"),e("body").one("click.lukio_woocommerce_product_variation_clicked",function(){o.addClass("closing"),t.removeClass("open"),setTimeout(()=>{o.removeClass("closing")},400)})}).on("focus",".lukio_woocommerce_product_variations_li.dropdown",function(){e(this).closest(".lukio_woocommerce_product_variations_dropdown").trigger("click")}).on("blur",".lukio_woocommerce_product_variations_li.dropdown",function(){e("body").trigger("click.lukio_woocommerce_product_variation_clicked")}).on("wc-product-gallery-after-init",".woocommerce-product-gallery",function(){s()})});