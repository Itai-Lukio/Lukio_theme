jQuery(document).ready(function(e){function o(e){return e.replaceAll(" ",".")}function t(e){lukio_helpers.animate_size(e,"height",0,400,0,{opacity:"0"},()=>{e.remove()})}function i(e){return 0!=e.siblings().length}function l(e){h&&p&&(localStorage.setItem(m,e),sessionStorage.setItem(m,e))}function r(o,t){o.each(function(){let o=this.outerHTML,i=e(this),l=i.data("place");e(this).remove(),"viewport"==l?t.append(o):t.closest(".woocommerce-product-gallery").append(o)})}async function a(e,o){let t=e[0].outerHTML;e.remove(),o.append(t)}function c(e,o,t){if(e.data("loop"))return;let i=e.closest(".woocommerce-product-gallery"),l=i.find(".lukio_product_gallery_arrow"),r=o.children("li"),a=0==t?"addClass":"removeClass",c=t==r.length-1?"addClass":"removeClass";l.filter(".prev")[a]("disable"),l.filter(".next")[c]("disable")}function n(o,t){let i=o.find(".lukio_product_gallery_arrow.prev"),l=o.find("ol.flex-control-nav"),r=t+1;l.find(`.${w}`).removeClass(w),l.find(`li:nth-of-type(${r})`).addClass(w),c(i,l,t);let a=l.find(`.${w}`);lukio_helpers.scroll_horizontally(a,l),o.find(".lukio_product_gallery_pagination_dot.active").removeClass("active"),o.find(`.lukio_product_gallery_pagination_dot:nth-of-type(${r})`).addClass("active"),e(".lukio_wc_gallery_video").each(function(){this.muted=!0}),u.trigger("lukio_gallery_display_updated",[o,l,a,t])}async function s(){clearTimeout(v);let o=e(".lukio_product_gallery_arrow"),t=e(".lukio_product_gallery_pagination"),i=o.closest(".flex-viewport"),l=o.closest(".woocommerce-product-gallery"),c=l.find("ol.flex-control-nav.flex-control-thumbs"),s=e(".lukio_wc_gallery_video_wrapper");0!==o.length&&(c.addClass("lukio_product_gallery_thumbs"),c.lukioDragScroll(),r(o,i),0!=t.length&&await a(t,i),n(l,0)),0!=s.length&&s.each(function(){e(`.woocommerce-product-gallery .flex-control-nav.flex-control-thumbs li:nth-of-type(${e(this).index()+1})`).addClass("lukio_wc_gallery_video_thumb")})}let _=e(".lukio_mini_cart_wrapper"),u=e("body"),d=window.location.origin+window.location.pathname,m=wc_cart_fragments_params.cart_hash_key,f="wc_fragments_refreshed",g=d==lukio_woo.checkout_url,p=d==lukio_woo.cart_url||g,h=!0,k=!1,w="lukio_active_thumb",v=null;switch(v=setTimeout(()=>{s()},5e3),d){case lukio_woo.checkout_url:f+=" updated_checkout";break;case lukio_woo.cart_url:f="updated_cart_totals wc_cart_emptied";break;default:f+=" wc_fragments_loaded"}try{window.sessionStorage.setItem("lukio_storage_check","test"),window.sessionStorage.removeItem("lukio_storage_check"),window.localStorage.setItem("lukio_storage_check","test"),window.localStorage.removeItem("lukio_storage_check")}catch(e){h=!1}h&&p&&e(window).on("storage onstorage",function(e){m===e.originalEvent.key&&localStorage.getItem(m)!==sessionStorage.getItem(m)&&(g&&(k=!0),u.trigger("lukio_update_wc_parts"))}),u.on(f,function(){k?k=!1:e.ajax({method:"POST",url:lukio_localize.ajax_url,data:{action:"lukio_woocommerce_refresh_mini_cart"},success:function(t){if(t){if(t=JSON.parse(t),!1===u.triggerHandler("lukio_should_fully_refresh_minicart")){let i=document.createElement("div");i.innerHTML=t.fragment;let l=e(i);i.remove(),l.find(".always_refresh").each(function(){_.find("."+o(this.className)).html(this.innerHTML)}),u.trigger("lukio_minicart_not_fully_refreshed",[l])}else _.html(t.fragment);l(t.cart_hash),u.trigger("lukio_cart_num_refresh",[t.items_count]).trigger("lukio_refresh_mini_cart_extra",[t.extra]).trigger("lukio_minicart_refreshed")}}})}).on("should_send_ajax_request.adding_to_cart",function(o,t){if(t.hasClass("disabled"))return!1;let i=t.closest(".lukio_theme_add_to_cart_form_wrapper");if(1==i.length){let o=i.find('input[name="quantity"]');1==o.length&&t.attr("data-quantity",o.val());let l=i.find('input[name="variation_id"]');1==l.length&&t.attr("data-product_id",l.val());let r={};1==i.length&&i.find("select[name^=attribute").each(function(){r[e(this).attr("name")]=this.value}),t.data("lukio_attributes",JSON.stringify(r))}}).on("lukio_update_wc_parts",function(){switch(window.location.origin+window.location.pathname){case lukio_woo.checkout_url:u.trigger("update_checkout");break;case lukio_woo.cart_url:u.trigger("wc_update_cart");break;default:u.trigger("wc_fragment_refresh")}}),e(document).on("click",".lukio_cart_product_quantity_btn",function(){let l=e(this),r=l.parent(),a=l.closest("li");if(r.hasClass("working")||l.hasClass("plus")&&r.hasClass("plus_disabled"))return;let c=parseInt(r.find(".lukio_cart_product_quantity_display").text());l.hasClass("minus")?c--:l.hasClass("plus")&&c++,r.addClass("working"),e.ajax({method:"POST",url:lukio_localize.ajax_url,data:{action:"lukio_update_cart_quantity",cart_item:r.data("key"),quantity:c},success:function(){if(1==a.closest(".lukio_mini_cart_wrapper").length){let e=i(a);(e||!e&&0!=c)&&u.one("lukio_should_fully_refresh_minicart",function(){return!1}).one("lukio_minicart_not_fully_refreshed",function(e,i){0!=c?a.html(i.find("."+o(a.attr("class"))).eq(a.index()).html()):t(a)})}u.trigger("lukio_update_wc_parts")}})}).on("click",".lukio_mini_cart_wrapper .remove",function(){let o=e(this).closest("li");i(o)?u.one("wc_fragments_loaded",function(){u.one("lukio_should_fully_refresh_minicart",function(){return!1}),p&&u.trigger("lukio_update_wc_parts")}).one("lukio_minicart_refreshed",function(){t(o)}):u.one("wc_fragments_loaded",function(){p&&u.trigger("lukio_update_wc_parts")})}).on("click",".woocommerce-product-gallery ol.flex-control-nav.flex-control-thumbs li",function(o){let t=e(this);if("LI"==o.target.tagName)t.find("img").trigger("click");else{let e=t.closest(".flex-control-nav.flex-control-thumbs"),o=e.closest(".woocommerce-product-gallery"),i=t.index();n(o,i)}}).on("click",".lukio_product_gallery_arrow",function(o){o.stopPropagation();let t=e(this);if(t.hasClass("disbled"))return;let i=t.data("action"),l=t.closest(".woocommerce-product-gallery"),r=t.data("loop"),a="next"==i?1:-1,c=l.find("ol.flex-control-nav"),n=c.find("li"),s=n.length-1,_=c.find(".flex-active").closest("li"),u=_.index()+a;u<0?u=r?s:0:u>s&&(u=r?0:s);let d=n.eq(u);d.find("img").trigger("click")}).on("click",".lukio_product_gallery_pagination_dot",function(){let o=e(this),t=o.data("index"),i=o.closest(".woocommerce-product-gallery");o.hasClass("active")||i.find("ol.flex-control-nav li").eq(t).find("img").trigger("click")}).on("zoom.destroy",".woocommerce-product-gallery__image.flex-active-slide",function(){let o=e(this).closest(".woocommerce-product-gallery"),t=o.find(".flex-control-nav.flex-control-thumbs .flex-active").closest("li").index();n(o,t)}).on("click",".lukio_woocommerce_product_variations_li",function(o){o.stopPropagation();let t=e(this);if(t.hasClass("selected"))return;let i=t.data("value"),l=t.closest(".lukio_woocommerce_product_variations_wrapper"),r=l.find(".lukio_woocommerce_product_variations_dropdown_display");l.find(".lukio_woocommerce_product_variations_li.selected").removeClass("selected"),t.addClass("selected"),l.find("select").val(i).trigger("change"),0!=r.length&&(r.text(t.text()),e("body").trigger("click.lukio_woocommerce_product_variation_clicked"))}).on("keydown",".lukio_woocommerce_product_variations_li",function(o){!o.key||"enter"!=o.key.toLocaleLowerCase()&&" "!=o.key||(o.preventDefault(),e(this).trigger("click"))}).on("click",".variations_form a.reset_variations",function(){let o=e(this).closest("form");o.find(".lukio_woocommerce_product_variations_li.selected").removeClass("selected"),o.find(".lukio_woocommerce_product_variations_dropdown_display").each(function(){let o=e(this);o.text(o.data("placeholder"))})}).on("click",".lukio_woocommerce_product_variations_dropdown",function(){let o=e(this),t=o.find(".lukio_woocommerce_product_variations_ul");o.addClass("open"),e("body").one("click.lukio_woocommerce_product_variation_clicked",function(){t.addClass("closing"),o.removeClass("open"),setTimeout(()=>{t.removeClass("closing")},400)})}).on("focus",".lukio_woocommerce_product_variations_li.dropdown",function(){e(this).closest(".lukio_woocommerce_product_variations_dropdown").trigger("click")}).on("blur",".lukio_woocommerce_product_variations_li.dropdown",function(){e("body").trigger("click.lukio_woocommerce_product_variation_clicked")}).on("wc-product-gallery-after-init",".woocommerce-product-gallery",function(){s()})});