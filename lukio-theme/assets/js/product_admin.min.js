jQuery(function(e){function i(e){e.block({message:null,overlayCSS:{background:"#fff",opacity:.6}})}function a(e,i,a){let o=wp.media(e);o.on("open",function(){let e=o.state().get("selection"),a=i.val(),t=wp.media.attachment(a);t.fetch(),e.add(t?[t]:[])}).on("close",function(){let e=o.state().get("selection");if(0==e.models.length)return;let t=e.models[0].id;i.val()!=t&&(i.val(t),e.models[0].changed.url&&a.attr("src",e.models[0].changed.url))}),o.open()}function o(){let i={},a=e(".lukio_gallery_video_row_wrapper.template"),o="",t=parseInt(e("#_thumbnail_id").val()),l=e("#product_image_gallery").val().split(","),_=e("#product_images_container .product_images"),r=e("#lukio_product_gallery_video");t>0&&(i[t]=e("#set-post-thumbnail img").attr("src")),l.forEach(e=>{parseInt(e)&&(i[e]=_.find(`li[data-attachment_id="${e}"] img`).attr("src"))});for(let t in i){let l=e(`.lukio_gallery_video_row_wrapper[data-id="${t}"]`);if(l.length>0)l.addClass("valid");else{let e=a[0].outerHTML;o+=e.replace("template","valid").replaceAll("0",t).replace(/(<img.*?src=")/,"$1"+i[t])}}r[Object.keys(i).length?"removeClass":"addClass"]("empty").append(o),e(".lukio_gallery_video_row_wrapper:not(.template):not(.valid)").remove(),e(".lukio_gallery_video_row_wrapper.valid").removeClass("valid")}e(document).on("click",".lukio_product_bulk_variations_image_picker",function(i){i.preventDefault();let o=e(this),t=o.siblings("#lukio_product_bulk_variations_image_input"),l=o.siblings(".lukio_product_bulk_variations_image_img"),_={multiple:!1,library:{type:"image"}};a(_,t,l)}).on("click",".lukio_product_bulk_variations_image_btn",function(){let a=e(this),o=a.data("action"),t=a.closest("#lukio_product_bulk_variations_image"),l=t.find("#lukio_product_bulk_variations_image_nonce").val(),_=t.find("[name^=lukio_product_bulk_variations_image_select]").serialize(),r=t.find("#lukio_product_bulk_variations_image_input").val();i(t),e.ajax({method:"POST",url:woocommerce_admin_meta_boxes_variations.ajax_url,data:{action:"lukio_product_bulk_variations_image_set",image_id:r,type:o,post_id:woocommerce_admin_meta_boxes_variations.post_id,filters_str:_,nonce:l},success:function(i){t.unblock(),e(".variations-pagenav .page-selector").trigger("change")}})}).on("reload","#variable_product_options",function(){let a=e("#lukio_product_bulk_variations_image"),o=a.find("#lukio_product_bulk_variations_image_nonce").val();i(a),e.ajax({method:"GET",url:woocommerce_admin_meta_boxes_variations.ajax_url,data:{action:"lukio_product_bulk_variations_reload",post_id:woocommerce_admin_meta_boxes_variations.post_id,nonce:o},success:function(e){e&&(e=JSON.parse(e),a.html(e.fragment.trim().replace(/^<div[^>]*>||<\/div>$/g,"")),a.unblock())}})}).on("click",".lukio_gallery_video_row_button",function(i){i.preventDefault();let o=e(this),t=o.closest(".lukio_gallery_video_row_wrapper"),l=t.find(".lukio_gallery_video_row_input"),_=t.find(".lukio_gallery_video_row_video"),r={multiple:!1,library:{type:"video"}};a(r,l,_)}).on("click",".lukio_gallery_video_row_video_remove",function(i){i.preventDefault();let a=e(this),o=a.closest(".lukio_gallery_video_row_wrapper"),t=o.find(".lukio_gallery_video_row_input"),l=o.find(".lukio_gallery_video_row_video");t.val(""),l.attr("src","")}).on("ajaxComplete",function(e,i,a){a.data&&!a.data.includes("get-post-thumbnail-html")||o()});let t=new MutationObserver(function(e){o()});t.observe(e("#product_image_gallery")[0],{attributes:!0,attributeFilter:["value"]})});